<div class="container-fluid">
  <app-page-title title="Competitions" [breadcrumbItems]="breadCrumbItems"></app-page-title>
  <div class="row">
    <div class="card m-2 p-2">
      <div class="row task-dates ">
        <div class="hori-timeline">
          <owl-carousel-o [options]="timelineCarousel" class="events navs-carousel">
            <ng-template carouselSlide>
              <div class="item event-list">
                <div>
                  <div class="event-date">
                    <div class="text-primary mb-1">{{ competition?.date | date: 'MMMM d, y'}}</div>
                    <h5 class="mb-4">Start Competition</h5>
                  </div>
                  <div class="event-down-icon">
                    <i class="bx bx-down-arrow-circle h1 text-primary down-arrow-icon"></i>
                  </div>

                  <div class="mt-3 px-3">
                    <p>it will start at {{ combineDateWithTime(competition?.date, competition?.startTime) | date : "dd/MM/yyyy hh:mm:ss"}}</p>
                  </div>
                </div>
              </div>
            </ng-template>
            <ng-template carouselSlide>
              <div class="item event-list">
                <div>
                  <div class="event-date">
                    <div class="text-primary mb-1">{{ competition?.endTime }}</div>
                    <h5 class="mb-4">End Competition</h5>
                  </div>
                  <div class="event-down-icon">
                    <i class="bx bx-down-arrow-circle h1 text-primary down-arrow-icon"></i>
                  </div>

                  <div class="mt-3 px-3">
                    <p>it will end at {{ combineDateWithTime(competition?.date, competition?.endTime) | date : "dd/MM/yyyy HH:mm:ss"}}</p>
                  </div>
                </div>
              </div>
            </ng-template>

          </owl-carousel-o>
        </div>
      </div>
    </div>
  </div>

  <div class="checkout-tabs">
    <div class="row">
      <div class="col-xl-2 col-sm-3">
        <ul ngbNav #nav="ngbNav" [activeId]="1" class="nav-pills flex-column">
          <li [ngbNavItem]="1">
            <a ngbNavLink>
              <i class="fas fa-info-circle d-block check-nav-icon mt-4 mb-2"></i>
              <p class="fw-bold mb-4">Competition Details</p>
            </a>
            <ng-template ngbNavContent>
              <div class="card">
                <div class="card-body">
                    <div class="row">
                      <div class="col-lg-4">
                        <div class="card mini-stats-wid">
                          <div class="card-body">
                            <div class="d-flex flex-wrap">
                              <div class="mr-3">
                                <h5 class="mb-0">AFTAS Competition</h5>
                                <p class="text-muted mb-2">Location: {{ competition?.location }}</p>
                              </div>
                              <div class="avatar-sm ms-auto">
                                <div class="avatar-title bg-light rounded-circle text-primary font-size-20">
                                  <i class="fas fa-search-location h1 text-primary"></i>
                                </div>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>

                      <div class="col-lg-4">
                        <div class="card blog-stats-wid">
                          <div class="card-body">
                            <div class="d-flex flex-wrap">
                              <div class="me-3">
                                <p class="text-muted mb-2">Number of hunting</p>
                                <h5 class="mb-0">{{ competition?.hunting?.length }}</h5>
                              </div>
                              <div class="avatar-sm ms-auto">
                                <div class="avatar-title bg-light rounded-circle text-primary font-size-20">
                                  <i class="fas fa-binoculars h1 text-primary"></i>
                                </div>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                      <div class="col-lg-4">
                        <div class="card blog-stats-wid">
                          <div class="card-body">
                            <div class="d-flex flex-wrap">
                              <div class="mr-3">
                                <p class="text-muted mb-2">Total Subscriptions</p>
                                <h5 class="mb-0">{{ competition?.ranks?.length || 0}}</h5>
                              </div>
                              <div class="avatar-sm ms-auto">
                                <div class="avatar-title bg-light rounded-circle text-primary font-size-20">
                                  <i class="fas fa-users h1 text-primary"></i>
                                </div>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>

                  <h2 class="font-size-20 mt-4">Dive into Victory: The AFTAS Awaits!</h2>
                  <p class="text-muted mb-4">Unleash your inner angler and cast your line in the AFTAS, a thrilling fishing competition taking place on <b>{{competition?.date | date:"MMMM d, y"}}</b> at <b>{{ competition?.location}}</b>. Put your skills to the test, compete for incredible prizes, and experience the camaraderie of fellow fishing enthusiasts.</p>

                  <div class="row">
                    <div class="col-md-6">
                      <h5>What to Expect:</h5>
                      <ul class="list-unstyled mb-4">
                        <li><i class="mdi mdi-trophy text-primary me-2"></i> Catch of the Day: Compete in Fish categories, vying for the biggest catch and the coveted title of AFTAS. </li>
                        <li><i class="mdi mdi-fishing-rod text-primary me-2"></i> Fishing Frenzy: Enjoy <b>{{ getCompetitionDuration(competition?.startTime, competition?.endTime) }}</b> hours of non-stop fishing action, surrounded by breathtaking scenery and friendly competition.</li>
                        <li><i class="mdi mdi-gift text-primary me-2"></i> Prizes Galore: Reel in amazing prizes, including <b>100 000 DH</b> plus other gifts. </li>
                        <li><i class="mdi mdi-face-smile text-primary me-2"></i> Fun for All: Whether you're a seasoned angler or a rookie casting your first line, this event is for everyone! Enjoy food trucks, live music, and family-friendly activities.</li>
                      </ul>
                    </div>
                    <div class="col-md-6">
                      <h5>Join the Excitement:</h5>
                      <ul class="list-unstyled mb-4">
                        <li><i class="mdi mdi-group text-primary me-2"></i> Number of Participants: <b>{{competition?.ranks?.length}}</b> passionate anglers are already gearing up for this exciting event. Will you join them?</li>
                        <li><i class="mdi mdi-fish text-primary me-2"></i> Number of Catches: Get ready for fierce competition! Last year's event saw <b>1983</b> impressive catches. Can you beat the record?</li>
                        <li><i class="mdi mdi-heart text-primary me-2"></i> More than Just a Competition: The AFTAS is more than just a chance to win big. It's about celebrating the sport of fishing, connecting with fellow enthusiasts, and enjoying the great outdoors.</li>
                      </ul>
                      <label class="btn btn-primary btn-sm">Register Now & Get Hooked!</label>
                    </div>
                  </div>
                </div>
              </div>
              <div class="row my-4">

              </div>
            </ng-template>
          </li>
          <li [ngbNavItem]="2" (click)="loadMemberRelationShip()">
            <a ngbNavLink>
              <i class="fas fa-users d-block check-nav-icon mt-4 mb-2"></i>
              <p class="fw-bold mb-4">Subscriptions</p>
            </a>
            <ng-template ngbNavContent>
              <div class="card">
                <div class="card-body">
                  <div class="d-flex justify-content-between m-2 ">
                      <h4 class="fw-bold mb-4">Subscriptions({{competition?.members?.length || 0}})</h4>

                      <button class="btn btn-success btn-sm" (click)="openModal(newSubscriptions)">
                        <i class="fas fa-plus-circle me-2"></i>
                        new subscription
                      </button>
                  </div>
                  <div class="table-responsive">
                    <table class="table table-nowrap table-centered mb-0" *ngIf="competition?.members?.length > 0; else contentVide">
                      <thead>
                      <tr>
                        <th scope="col">FullName</th>
                        <th scope="col">Identity</th>
                        <th scope="col">Number of hunting</th>
                        <th scope="col">actions</th>
                      </tr>
                      </thead>
                      <tbody>
                        <tr *ngFor="let member of competition?.members">
                          <td>
                            <h5 class="font-size-14 mb-1">{{ member?.name +" "+ member?.familyName}}</h5>
                          </td>
                          <td>
                            <h5 class="font-size-14 mb-1">{{ member?.identityNumber }}</h5>
                          </td>
                          <td>
                            <h5 class="font-size-14 mb-1">{{ member?.nbrHunting }}</h5>
                          </td>
                          <td>
                            <button type="button" class="btn btn-primary btn-sm btn-rounded" (click)="openModal(content, member.number)">
                              Add New Hunting</button>
                          </td>
                        </tr>
                      </tbody>
                    </table>
                    <ng-template #contentVide>
                      <ngb-alert type="warning" [dismissible]="false">
                        <strong>Warning!</strong> No subscriptions found.
                      </ngb-alert>
                    </ng-template>
                  </div>
                </div>
              </div>
            </ng-template>
          </li>
          <li [ngbNavItem]="3">
            <a ngbNavLink (click)="calculateRanks()">
              <i class="fas fa-medal d-block check-nav-icon mt-4 mb-2"></i>
              <p class="fw-bold mb-4">Ranking</p>
            </a>
            <ng-template ngbNavContent>
              <div class="card">
                <div class="card-body">
                  <!-- Display Top 3 Podium with Buttons -->
                  <div *ngIf="competition?.ranks && ranks.length > 0" class="mt-4">
                    <h5 class="font-size-15 mb-3">Top 3 <i class="fas fa-trophy text-warning"></i></h5>
                    <div class="row text-center">
                      <!-- Gold Button -->
                      <div *ngFor="let topRank of ranks.slice(0, 3)" class="col-md-4">
                        <div class="d-flex flex-column justify-content-center">
                          <i class="fas fa-trophy h1"
                             [class]="topRank?.rank == 1? 'text-warning'
                              : topRank?.rank == 2? 'text-secondary' : 'text-bronze'"
                          ></i>
                          {{ topRank?.rank }}
                        </div>
                        <div class="card">
                          <div class="card-body">
                            <h5 class="card-title">{{ topRank?.member?.name + ' ' + topRank?.member?.familyName }}</h5>
                            <p class="card-text">Points: <i class="fas fa-star text-warning"></i> {{ topRank?.score }}</p>
                          </div>
                        </div>
                      </div>

                    </div>
                  </div>

                  <div *ngIf="ranks && ranks.length > 3" class="mt-4">
                    <h5 class="font-size-15 mb-3">Other Ranks</h5>
                    <div class="table-responsive">
                      <table class="table table-nowrap table-centered mb-0">
                        <thead>
                        <tr>
                          <th scope="col">Rank</th>
                          <th scope="col">Member</th>
                          <th scope="col">Points</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr *ngFor="let otherRank of ranks.slice(3)">
                          <td>{{ otherRank.rank }}</td>
                          <td>{{ otherRank.member?.name + ' ' + otherRank.member?.familyName }}</td>
                          <td>{{ otherRank.score }}</td>
                        </tr>
                        </tbody>
                      </table>
                    </div>
                  </div>

                </div>
              </div>

            </ng-template>
          </li>
        </ul>
      </div>
      <div class="col-lg-10">
        <div [ngbNavOutlet]="nav"></div>
      </div>
    </div>
  </div>
</div>


<ng-template #content role="document" let-modal>
  <div class="modal-body">

    <form (ngSubmit)="saveFishHunting()" class="modal-form">
      <div class="modal-header">
        <h5 class="modal-title mt-0">Fish Hunting Details</h5>
        <button type="button" class="btn-close" aria-hidden="true" (click)="modal.dismiss('Cross click')"></button>
      </div>
      <div class="modal-body">
        <div class="mb-2">
          <label for="fishWeight">Fish Weight</label>
          <input type="number" [(ngModel)]="fishHunting.fishWeight" name="fishWeight" class="form-control" id="fishWeight" placeholder="Enter fish weight" />
        </div>
        <div class="mb-2">
          <label for="fishName">Fish Name</label>
          <select [(ngModel)]="fishHunting.fishName" name="fishName" class="form-control" id="fishName" >
            <option value="" selected disabled>Select fish</option>
            <option *ngFor="let fish of fishes" [value]="fish.name">
              <span class="text-primary">{{fish.name}} / </span>
              <span class="text-muted">average Weight: ({{fish.averageWeight}})</span>
            </option>
          </select>
        </div>
      </div>
      <div class="modal-footer">
        <button type="submit" class="btn btn-primary">Save</button>
        <button type="button" class="btn btn-secondary" (click)="modal.close('Close click')">Close</button>
      </div>
    </form>

  </div>
</ng-template>

<ng-template #newSubscriptions role="document" let-modal>
  <div class="modal-body">

    <form (ngSubmit)="createNewSubscription()" class="modal-form">
      <div class="modal-header">
        <h5 class="modal-title mt-0">Fish Hunting Details</h5>
        <button type="button" class="btn-close" aria-hidden="true" (click)="modal.dismiss('Cross click')"></button>
      </div>
      <div class="modal-body">

        <div class="mb-2">
          <label for="memberId">Fish Name</label>
          <select [(ngModel)]="memberIdToSubscribe" name="fishName" class="form-control" id="memberId" >
            <option value="" selected disabled>Select fish</option>
            <option *ngFor="let member of members" [value]="member.number">
              <span class="text-muted">{{member.number + ': '}}</span><span class="text-primary">{{member.name + " " + member.familyName}}</span>
            </option>
          </select>
        </div>
      </div>
      <div class="modal-footer">
        <button type="submit" class="btn btn-primary">Save</button>
        <button type="button" class="btn btn-secondary" (click)="modal.close('Close click')">Close</button>
      </div>
    </form>

  </div>
</ng-template>
