<div class="container-fluid">
  <app-page-title title="Competitions" [breadcrumbItems]="breadCrumbItems"></app-page-title>
  <div class="row">
    <div class="card m-2 p-2">
      <div class="row task-dates ">
        <div class="hori-timeline">
          <owl-carousel-o [options]="timelineCarousel" class="events navs-carousel">
            <ng-template carouselSlide>
              <div class="item event-list">
                <div>
                  <div class="event-date">
                    <div class="text-primary mb-1">{{ competition?.date | date: 'MMMM d, y'}}</div>
                    <h5 class="mb-4">Start Competition</h5>
                  </div>
                  <div class="event-down-icon">
                    <i class="bx bx-down-arrow-circle h1 text-primary down-arrow-icon"></i>
                  </div>

                  <div class="mt-3 px-3">
                    <p>it will start at {{ combineDateWithTime(competition?.date, competition?.startTime) | date : "dd/MM/yyyy hh:mm:ss"}}</p>
                  </div>
                </div>
              </div>
            </ng-template>
            <ng-template carouselSlide>
              <div class="item event-list">
                <div>
                  <div class="event-date">
                    <div class="text-primary mb-1">{{ competition?.endTime }}</div>
                    <h5 class="mb-4">End Competition</h5>
                  </div>
                  <div class="event-down-icon">
                    <i class="bx bx-down-arrow-circle h1 text-primary down-arrow-icon"></i>
                  </div>

                  <div class="mt-3 px-3">
                    <p>it will start at {{ combineDateWithTime(competition?.date, competition?.endTime) | date : "dd/MM/yyyy hh:mm:ss"}}</p>
                  </div>
                </div>
              </div>
            </ng-template>

          </owl-carousel-o>
        </div>
      </div>
    </div>
  </div>

  <div class="checkout-tabs">
    <div class="row">
      <div class="col-xl-2 col-sm-3">
        <ul ngbNav #nav="ngbNav" [activeId]="1" class="nav-pills flex-column">
          <li [ngbNavItem]="1">
            <a ngbNavLink>
              <i class="fas fa-info-circle d-block check-nav-icon mt-4 mb-2"></i>
              <p class="fw-bold mb-4">Shipping Info</p>
            </a>
            <ng-template ngbNavContent>
              <div class="card">
                <div class="card-body">
                  <div class="media">
                    <img src="assets/images/companies/img-1.png" alt="" class="avatar-sm me-4">

                    <div class="media-body overflow-hidden">
                      <h5 class="text-truncate font-size-15">{{ competition?.code }}</h5>
                      <p class="text-muted">Location: {{ competition?.location }}</p>
                    </div>

                    <div class="card">
                      <div class="card-body">
                        <h4 class="card-title mb-4">Subscribes</h4>

                        <div class="text-center">
                          <div class="mb-4">
                            <i class="bx bx-map-pin text-primary display-4"></i>
                          </div>
                          <h3>{{competition?.ranks?.length}}</h3>
                          <p>Total subscripts to the competition</p>
                        </div>
                      </div>
                    </div>
                  </div>

                  <h5 class="font-size-15 mt-4">Competition Details :</h5>

                  <p class="text-muted">To an English person, it will seem like simplified English, as a skeptical Cambridge
                    friend of mine told me what Occidental is. The European languages are members of the same family. Their
                    separate existence is a myth. For science, music, sport, etc,</p>

                  <div class="text-muted mt-4">
                    <p><i class="mdi mdi-chevron-right text-primary me-1"></i> Number of participation: {{ competition?.ranks.length}}</p>
                    <p><i class="mdi mdi-chevron-right text-primary me-1"></i> Number of hunting: {{ competition?.hunting.length}}</p>
                    <p><i class="mdi mdi-chevron-right text-primary me-1"></i> If several languages coalesce</p>
                  </div>

                </div>
              </div>
              <div class="row my-4">

              </div>
            </ng-template>
          </li>
          <li [ngbNavItem]="2" (click)="loadMemberRelationShip()">
            <a ngbNavLink>
              <i class="fas fa-users d-block check-nav-icon mt-4 mb-2"></i>
              <p class="fw-bold mb-4">Subscriptions</p>
            </a>
            <ng-template ngbNavContent>
              <div class="card">
                <div class="card-body">
                  <div class="d-flex justify-content-between m-2 ">
                    <div class="card">
                      <p class="fw-bold mb-4">Subscriptions({{competition?.members?.length || 0}})</p>
                    </div>

                    <button class="btn btn-primary p-1 " (click)="openModal(newSubscriptions)">add new subscription</button>
                  </div>
                  <div class="table-responsive">
                    <table class="table table-nowrap table-centered mb-0" *ngIf="competition?.members?.length > 0; else contentVide">
                      <thead>
                      <tr>
                        <th scope="col">FullName</th>
                        <th scope="col">Identity</th>
                        <th scope="col">Number of hunting</th>
                        <th scope="col">actions</th>
                      </tr>
                      </thead>
                      <tbody>
                      <tr *ngFor="let member of competition?.members">
                        <td>
                          <h5 class="font-size-14 mb-1">{{ member?.name +" "+ member?.familyName}}</h5>
                        </td>
                        <td>
                          <h5 class="font-size-14 mb-1">{{ member?.identityNumber }}</h5>
                        </td>
                        <td>
                          <h5 class="font-size-14 mb-1">{{ member?.nbrHunting }}</h5>
                        </td>
                        <td>
                          <button type="button" class="btn btn-primary btn-sm btn-rounded" (click)="openModal(content, member.number)">
                            Add New Hunting</button>
                        </td>
                      </tr>
                      </tbody>
                    </table>
                    <ng-template #contentVide>
                      <ngb-alert type="warning" [dismissible]="false">
                        <strong>Warning!</strong> No subscriptions found.
                      </ngb-alert>
                    </ng-template>
                  </div>
                </div>
              </div>
            </ng-template>
          </li>
          <li [ngbNavItem]="3">
            <a ngbNavLink>
              <i class="fas fa-medal d-block check-nav-icon mt-4 mb-2"></i>
              <p class="fw-bold mb-4">Ranking</p>
            </a>
            <ng-template ngbNavContent>
              <div class="card">
                <div class="card-body">

                  <button disabled class="btn btn-secondary">
                    <i class="fa fa-spinner d-block check-nav-icon mb-2"></i>
                  </button>

                </div>
              </div>

            </ng-template>
          </li>
        </ul>
      </div>
      <div class="col-lg-10">
        <div [ngbNavOutlet]="nav"></div>
      </div>
    </div>
  </div>
</div>


<ng-template #content role="document" let-modal>
  <div class="modal-body">

    <form (ngSubmit)="saveFishHunting()" class="modal-form">
      <div class="modal-header">
        <h5 class="modal-title mt-0">Fish Hunting Details</h5>
        <button type="button" class="btn-close" aria-hidden="true" (click)="modal.dismiss('Cross click')"></button>
      </div>
      <div class="modal-body">
        <div class="mb-2">
          <label for="fishWeight">Fish Weight</label>
          <input type="number" [(ngModel)]="fishHunting.fishWeight" name="fishWeight" class="form-control" id="fishWeight" placeholder="Enter fish weight" />
        </div>
        <div class="mb-2">
          <label for="fishName">Fish Name</label>
          <select [(ngModel)]="fishHunting.fishName" name="fishName" class="form-control" id="fishName" >
            <option value="" selected disabled>Select fish</option>
            <option *ngFor="let fish of fishes" [value]="fish.name">
              <span class="text-primary">{{fish.name}}</span> <span class="text-muted">average Weight: ({{fish.averageWeight}})</span>
            </option>
          </select>
        </div>
      </div>
      <div class="modal-footer">
        <button type="submit" class="btn btn-primary">Save</button>
        <button type="button" class="btn btn-secondary" (click)="modal.close('Close click')">Close</button>
      </div>
    </form>

  </div>
</ng-template>

<ng-template #newSubscriptions role="document" let-modal>
  <div class="modal-body">

    <form (ngSubmit)="createNewSubscription()" class="modal-form">
      <div class="modal-header">
        <h5 class="modal-title mt-0">Fish Hunting Details</h5>
        <button type="button" class="btn-close" aria-hidden="true" (click)="modal.dismiss('Cross click')"></button>
      </div>
      <div class="modal-body">

        <div class="mb-2">
          <label for="memberId">Fish Name</label>
          <select [(ngModel)]="memberIdToSubscribe" name="fishName" class="form-control" id="memberId" >
            <option value="" selected disabled>Select fish</option>
            <option *ngFor="let member of members" [value]="member.number">
              <span class="text-muted">{{member.number + ': '}}</span><span class="text-primary">{{member.name + " " + member.familyName}}</span>
            </option>
          </select>
        </div>
      </div>
      <div class="modal-footer">
        <button type="submit" class="btn btn-primary">Save</button>
        <button type="button" class="btn btn-secondary" (click)="modal.close('Close click')">Close</button>
      </div>
    </form>

  </div>
</ng-template>
